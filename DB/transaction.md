- [트랜잭션](#트랜잭션)
  - [트랜잭션 ACID](#트랜잭션-acid)

# 트랜잭션

트랜잭션은 하나의 요청을 안전하게 처리하도록 보장해주는 것을 뜻한다

<br/>

예를 들어,

**A가 B에게 5000원을 계좌이체한다**는 하나의 요청은

- A의 잔고를 5000원 감소
- B의 잔고를 5000원 증가

라는 두 가지 작업이 합쳐져 하나의 작업처럼 동작해야 한다

<br/>

트랜잭션 기능을 사용하면 두 작업 모두 성공해야 데이터베이스에 저장하고, 중간에 하나라도 실패하면 이전 상태로 돌아갈 수 있다

<br/>

모든 작업이 성공해서 데이터베이스에 반영하는 것을 commit, 하나라도 실패해서 트랜잭션 이전 상태로 되돌리는 것을 rollback이라 한다

<br/>

데이터베이스는 트랜잭션을 지원하기 때문에 사용하는 것이다

## 트랜잭션 ACID
트랜잭션은 원자성(Atomicity), 일관성(Consistency), 격리성(Isolation), 지속성(Durablility)을 보장해야 한다

### 원자성 (Atomicity)

트랜잭션 내에서 실행한 작업들은 하나의 작업인 것 처럼 모두 성공하거나 모두 실패해야 한다

예를 들어, 데이터베이스에서 정한 무결성 제약조건을 항상 만족해야 한다(?)

### 일관성 (Consistency)

모든 트랜잭션은 일관성 있는 데이터베이스 상태를 유지해야 한다

예를 들어, 데이터베이스에서 정한 무결성 제약 조건을 항상 만족해야 한다

### 격리성 (Isolation)

동시에 실행되는 트랜잭션들이 서로에게 영향을 미치지 않도록 격리한다

예를 들어, 동시에 같은 데이터를 수정하지 못하도록 해야한다

격리성은 동시성과 관련된 성능 이슈로 트랜잭션 격리 수준(Isolation level)을 선택할 있다

→ 트랜잭션 간의 격리성을 완전히 보장하려면 트랜잭션을 순서대로 실행해야 한다. 이렇게 하면 병렬처리가 불가능 하기 때문에 동시 처리 성능이 매우 나빠진다. 이런 문제로 ANSI 표준은 트랜잭션의 격리 수준을 4단계로 나누어 정의한다

- READ UNCOMMITED (커밋되지 않은 읽기)
- READ COMMITED (커밋된 읽기)
- REPEATABLE READ (반복 가능한 읽기)
- SERIALIZABLE (직렬화 가능)

단계가 높아질수록 데이터베이스 성능이 나빠진다.  따라서, 일반적으로 READ COMMITED, REPEATABLE READ를 많이 사용한다

### 지속성 (Durability)

트랜잭션을 성공적으로 끝내면 그 결과가 항상 기록되어야 한다.

예를 들어, 중간에 시스템에 문제가 발생해도 데이터베이스 로그 등을 사용해서 성공한 트랜잭션 내용을 복구해야 한다

<br/>

---

<br/>

출처 및 참고
- [스프링 DB 1편 - 데이터 접근 핵심 원리(김영한)](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-db-1/dashboard)